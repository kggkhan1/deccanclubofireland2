// Prayer Times Functionality
document.addEventListener('DOMContentLoaded', function() {
    const timetable = {
        "July": {
            "1": ["2:52", "13:31", "17:57", "22:00", "23:30"],
            "2": ["2:53", "13:31", "17:57", "22:00", "23:30"],
            "3": ["2:54", "13:31", "17:57", "21:59", "23:29"],
            "4": ["2:55", "13:31", "17:57", "21:59", "23:29"],
            "5": ["2:56", "13:31", "17:56", "21:58", "23:28"],
            "6": ["2:57", "13:31", "17:56", "21:58", "23:28"],
            "7": ["2:58", "13:32", "17:56", "21:57", "23:27"],
            "8": ["3:00", "13:32", "17:56", "21:56", "23:26"],
            "9": ["3:01", "13:32", "17:56", "21:56", "23:26"],
            "10": ["3:03", "13:32", "17:56", "21:55", "23:26"],
            "11": ["3:04", "13:32", "17:56", "21:54", "23:26"],
            "12": ["3:06", "13:32", "17:55", "21:53", "23:25"],
            "13": ["3:07", "13:32", "17:55", "21:52", "23:25"],
            "14": ["3:09", "13:32", "17:55", "21:51", "23:25"],
            "15": ["3:11", "13:33", "17:55", "21:50", "23:25"],
            "16": ["3:13", "13:33", "17:54", "21:49", "23:25"],
            "17": ["3:14", "13:33", "17:54", "21:48", "23:24"],
            "18": ["3:16", "13:33", "17:54", "21:47", "23:24"],
            "19": ["3:18", "13:33", "17:53", "21:45", "23:24"],
            "20": ["3:20", "13:33", "17:53", "21:44", "23:24"],
            "21": ["3:22", "13:33", "17:52", "21:43", "23:23"],
            "22": ["3:24", "13:33", "17:52", "21:42", "23:23"],
            "23": ["3:26", "13:33", "17:51", "21:40", "23:23"],
            "24": ["3:28", "13:33", "17:51", "21:39", "23:23"],
            "25": ["3:30", "13:33", "17:50", "21:37", "23:23"],
            "26": ["3:32", "13:33", "17:50", "21:36", "23:22"],
            "27": ["3:34", "13:33", "17:49", "21:34", "23:20"],
            "28": ["3:36", "13:33", "17:49", "21:33", "23:18"],
            "29": ["3:38", "13:33", "17:48", "21:31", "23:16"],
            "30": ["3:40", "13:33", "17:47", "21:29", "23:14"],
            "31": ["3:42", "13:33", "17:47", "21:28", "23:12"]
        },
        "August": {
            "1": ["3:44", "13:33", "17:46", "21:26", "23:10"],
            "2": ["3:46", "13:33", "17:45", "21:24", "23:08"],
            "3": ["3:49", "13:33", "17:44", "21:22", "23:05"],
            "4": ["3:51", "13:33", "17:44", "21:21", "23:03"],
            "5": ["3:53", "13:33", "17:43", "21:19", "23:01"],
            "6": ["3:55", "13:33", "17:42", "21:17", "22:59"],
            "7": ["3:57", "13:33", "17:41", "21:15", "22:57"],
            "8": ["3:59", "13:33", "17:40", "21:13", "22:54"],
            "9": ["4:01", "13:32", "17:39", "21:11", "22:52"],
            "10": ["4:04", "13:32", "17:38", "21:09", "22:50"],
            "11": ["4:06", "13:32", "17:38", "21:07", "22:47"],
            "12": ["4:08", "13:32", "17:37", "21:05", "22:45"],
            "13": ["4:10", "13:32", "17:36", "21:03", "22:43"],
            "14": ["4:12", "13:32", "17:35", "21:01", "22:40"],
            "15": ["4:14", "13:32", "17:33", "20:59", "22:38"],
            "16": ["4:16", "13:31", "17:32", "20:57", "22:35"],
            "17": ["4:19", "13:31", "17:31", "20:55", "22:33"],
            "18": ["4:21", "13:31", "17:30", "20:53", "22:30"],
            "19": ["4:23", "13:31", "17:29", "20:51", "22:28"],
            "20": ["4:25", "13:31", "17:28", "20:48", "22:26"],
            "21": ["4:27", "13:30", "17:27", "20:46", "22:23"],
            "22": ["4:29", "13:30", "17:25", "20:44", "22:21"],
            "23": ["4:31", "13:30", "17:24", "20:42", "22:18"],
            "24": ["4:33", "13:30", "17:23", "20:40", "22:16"],
            "25": ["4:35", "13:30", "17:22", "20:37", "22:13"],
            "26": ["4:37", "13:29", "17:20", "20:35", "22:11"],
            "27": ["4:39", "13:29", "17:19", "20:33", "22:08"],
            "28": ["4:41", "13:29", "17:18", "20:31", "22:06"],
            "29": ["4:43", "13:29", "17:16", "20:28", "22:03"],
            "30": ["4:45", "13:29", "17:15", "20:26", "22:00"],
            "31": ["4:47", "13:29", "17:13", "20:24", "21:58"]
        },
        "September": {
            "1": ["4:49", "13:28", "17:12", "20:21", "21:55"],
            "2": ["4:51", "13:28", "17:11", "20:19", "21:53"],
            "3": ["4:53", "13:28", "17:09", "20:17", "21:50"],
            "4": ["4:55", "13:28", "17:08", "20:14", "21:48"],
            "5": ["4:57", "13:27", "17:06", "20:12", "21:45"],
            "6": ["4:59", "13:27", "17:05", "20:09", "21:43"],
            "7": ["5:01", "13:27", "17:03", "20:07", "21:40"],
            "8": ["5:03", "13:27", "17:02", "20:05", "21:38"],
            "9": ["5:05", "13:27", "17:00", "20:02", "21:35"],
            "10": ["5:07", "13:27", "16:58", "20:00", "21:32"],
            "11": ["5:09", "13:26", "16:57", "19:57", "21:30"],
            "12": ["5:10", "13:26", "16:55", "19:55", "21:27"],
            "13": ["5:12", "13:26", "16:53", "19:52", "21:25"],
            "14": ["5:14", "13:26", "16:52", "19:50", "21:22"],
            "15": ["5:16", "13:26", "16:50", "19:48", "21:20"],
            "16": ["5:18", "13:25", "16:48", "19:45", "21:17"],
            "17": ["5:20", "13:25", "16:47", "19:43", "21:15"],
            "18": ["5:21", "13:25", "16:45", "19:40", "21:12"],
            "19": ["5:23", "13:25", "16:43", "19:38", "21:10"],
            "20": ["5:25", "13:25", "16:42", "19:35", "21:07"],
            "21": ["5:27", "13:25", "16:40", "19:33", "21:05"],
            "22": ["5:28", "13:24", "16:38", "19:30", "21:02"],
            "23": ["5:30", "13:24", "16:36", "19:28", "21:00"],
            "24": ["5:32", "13:24", "16:35", "19:25", "20:57"],
            "25": ["5:34", "13:24", "16:33", "19:23", "20:55"],
            "26": ["5:35", "13:24", "16:31", "19:20", "20:52"],
            "27": ["5:37", "13:23", "16:29", "19:18", "20:50"],
            "28": ["5:39", "13:23", "16:27", "19:16", "20:47"],
            "29": ["5:41", "13:23", "16:26", "19:13", "20:45"],
            "30": ["5:42", "13:23", "16:24", "19:11", "20:42"]
        },
        "October": {
            "1": ["5:44", "13:23", "16:22", "19:08", "20:40"],
            "2": ["5:46", "13:23", "16:20", "19:06", "20:38"],
            "3": ["5:47", "13:22", "16:18", "19:03", "20:35"],
            "4": ["5:49", "13:22", "16:17", "19:01", "20:33"],
            "5": ["5:51", "13:22", "16:15", "18:58", "20:31"],
            "6": ["5:52", "13:22", "16:13", "18:56", "20:28"],
            "7": ["5:54", "13:22", "16:11", "18:54", "20:26"],
            "8": ["5:56", "13:22", "16:09", "18:51", "20:24"],
            "9": ["5:57", "13:21", "16:07", "18:49", "20:21"],
            "10": ["5:59", "13:21", "16:06", "18:46", "20:19"],
            "11": ["6:01", "13:21", "16:04", "18:44", "20:17"],
            "12": ["6:02", "13:21", "16:02", "18:42", "20:15"],
            "13": ["6:04", "13:21", "16:00", "18:39", "20:12"],
            "14": ["6:06", "13:21", "15:58", "18:37", "20:10"],
            "15": ["6:07", "13:21", "15:57", "18:35", "20:08"],
            "16": ["6:09", "13:20", "15:55", "18:32", "20:06"],
            "17": ["6:11", "13:20", "15:53", "18:30", "20:04"],
            "18": ["6:12", "13:20", "15:51", "18:28", "20:02"],
            "19": ["6:14", "13:20", "15:50", "18:26", "20:00"],
            "20": ["6:16", "13:20", "15:48", "18:23", "19:58"],
            "21": ["6:17", "13:20", "15:46", "18:21", "19:56"],
            "22": ["6:19", "13:20", "15:44", "18:19", "19:54"],
            "23": ["6:21", "13:20", "15:43", "18:17", "19:52"],
            "24": ["6:22", "13:19", "15:41", "18:15", "19:50"],
            "25": ["6:24", "13:19", "15:39", "18:13", "19:48"],
            "26": ["5:26", "12:19", "14:38", "17:10", "18:46"],
            "27": ["5:27", "12:19", "14:36", "17:08", "18:44"],
            "28": ["5:29", "12:19", "14:34", "17:06", "18:42"],
            "29": ["5:31", "12:19", "14:33", "17:04", "18:40"],
            "30": ["5:32", "12:19", "14:31", "17:02", "18:39"],
            "31": ["5:34", "12:19", "14:30", "17:00", "18:37"]
        },
        "November": {
            "1": ["5:35", "12:19", "14:28", "16:58", "18:35"],
            "2": ["5:37", "12:19", "14:27", "16:56", "18:33"],
            "3": ["5:39", "12:19", "14:25", "16:54", "18:32"],
            "4": ["5:40", "12:19", "14:24", "16:52", "18:30"],
            "5": ["5:42", "12:19", "14:22", "16:51", "18:29"],
            "6": ["5:44", "12:19", "14:21", "16:49", "18:27"],
            "7": ["5:45", "12:19", "14:19", "16:47", "18:26"],
            "8": ["5:47", "12:19", "14:18", "16:45", "18:24"],
            "9": ["5:48", "12:20", "14:17", "16:43", "18:23"],
            "10": ["5:50", "12:20", "14:15", "16:42", "18:21"],
            "11": ["5:52", "12:20", "14:14", "16:40", "18:20"],
            "12": ["5:53", "12:20", "14:13", "16:38", "18:18"],
            "13": ["5:55", "12:20", "14:12", "16:37", "18:17"],
            "14": ["5:56", "12:20", "14:10", "16:35", "18:16"],
            "15": ["5:58", "12:20", "14:09", "16:34", "18:15"],
            "16": ["6:00", "12:21", "14:08", "16:32", "18:13"],
            "17": ["6:01", "12:21", "14:07", "16:31", "18:12"],
            "18": ["6:03", "12:21", "14:06", "16:29", "18:11"],
            "19": ["6:04", "12:21", "14:05", "16:28", "18:10"],
            "20": ["6:06", "12:21", "14:04", "16:27", "18:09"],
            "21": ["6:07", "12:22", "14:03", "16:25", "18:08"],
            "22": ["6:09", "12:22", "14:02", "16:24", "18:07"],
            "23": ["6:10", "12:22", "14:01", "16:23", "18:06"],
            "24": ["6:12", "12:22", "14:01", "16:22", "18:05"],
            "25": ["6:13", "12:23", "14:00", "16:21", "18:05"],
            "26": ["6:14", "12:23", "13:59", "16:20", "18:04"],
            "27": ["6:16", "12:23", "13:58", "16:19", "18:03"],
            "28": ["6:17", "12:23", "13:58", "16:18", "18:02"],
            "29": ["6:19", "12:24", "13:57", "16:17", "18:02"],
            "30": ["6:20", "12:24", "13:56", "16:16", "18:01"]
        },
        "December": {
            "1": ["6:21", "12:24", "13:56", "16:15", "18:01"],
            "2": ["6:22", "12:24", "13:55", "16:15", "18:00"],
            "3": ["6:24", "12:25", "13:55", "16:14", "18:00"],
            "4": ["6:25", "12:25", "13:55", "16:13", "17:59"],
            "5": ["6:26", "12:25", "13:54", "16:13", "17:59"],
            "6": ["6:27", "12:26", "13:54", "16:12", "17:59"],
            "7": ["6:28", "12:26", "13:54", "16:12", "17:58"],
            "8": ["6:29", "12:26", "13:53", "16:11", "17:58"],
            "9": ["6:30", "12:27", "13:53", "16:11", "17:58"],
            "10": ["6:31", "12:27", "13:53", "16:11", "17:58"],
            "11": ["6:32", "12:28", "13:53", "16:10", "17:58"],
            "12": ["6:33", "12:28", "13:53", "16:10", "17:58"],
            "13": ["6:34", "12:28", "13:53", "16:10", "17:58"],
            "14": ["6:35", "12:29", "13:53", "16:10", "17:58"],
            "15": ["6:36", "12:29", "13:53", "16:10", "17:58"],
            "16": ["6:37", "12:30", "13:54", "16:10", "17:58"],
            "17": ["6:38", "12:30", "13:54", "16:10", "17:58"],
            "18": ["6:38", "12:30", "13:54", "16:10", "17:59"],
            "19": ["6:39", "12:31", "13:54", "16:11", "17:59"],
            "20": ["6:40", "12:31", "13:55", "16:11", "17:59"],
            "21": ["6:40", "12:32", "13:55", "16:11", "18:00"],
            "22": ["6:41", "12:32", "13:56", "16:12", "18:00"],
            "23": ["6:41", "12:33", "13:56", "16:12", "18:00"],
            "24": ["6:42", "12:33", "13:57", "16:13", "18:01"],
            "25": ["6:42", "12:34", "13:57", "16:13", "18:02"],
            "26": ["6:42", "12:34", "13:58", "16:14", "18:02"],
            "27": ["6:43", "12:35", "13:58", "16:15", "18:03"],
            "28": ["6:43", "12:35", "13:59", "16:16", "18:04"],
            "29": ["6:43", "12:36", "14:00", "16:16", "18:04"],
            "30": ["6:43", "12:36", "14:01", "16:17", "18:05"],
            "31": ["6:43", "12:37", "14:01", "16:18", "18:06"]
        }
    };

    function updateTimetable() {
        const now = new Date();
        const day = now.getDate();
        const month = now.getMonth();
        const year = now.getFullYear();
        
        const monthNames = ["January", "February", "March", "April", "May", "June", 
                          "July", "August", "September", "October", "November", "December"];
        const currentMonth = monthNames[month];
        
        document.getElementById("todayDate").textContent = now.toDateString();

        // Check if we have data for this month and day
        if (!timetable[currentMonth] || !timetable[currentMonth][day]) {
            document.getElementById("nextPrayer").textContent = "Timetable not available for this date.";
            return;
        }

        const [fajr, dhuhr, asr, maghrib, isha] = timetable[currentMonth][day];

        // Update adhan times
        document.getElementById("FajrAdhan").textContent = fajr;
        document.getElementById("DhuhrAdhan").textContent = dhuhr;
        document.getElementById("AsrAdhan").textContent = asr;
        document.getElementById("MaghribAdhan").textContent = maghrib;
        document.getElementById("IshaAdhan").textContent = isha;

        updateNextPrayer(fajr, dhuhr, asr, maghrib, isha);
    }

    function updateNextPrayer(fajr, dhuhr, asr, maghrib, isha) {
        const now = new Date();
        const prayers = [
            { name: "Fajr", time: fajr },
            { name: "Dhuhr", time: dhuhr },
            { name: "Asr", time: asr },
            { name: "Maghrib", time: maghrib },
            { name: "Isha", time: isha }
        ];

        // Find the next prayer
        for (const prayer of prayers) {
            const [h, m] = prayer.time.split(":").map(Number);
            const prayerTime = new Date(now.getFullYear(), now.getMonth(), now.getDate(), h, m);
            
            if (now < prayerTime) {
                updateCountdown(prayerTime, prayer.name);
                return;
            }
        }

        // If all prayers have passed for today, next is Fajr tomorrow
        const tomorrow = new Date(now);
        tomorrow.setDate(tomorrow.getDate() + 1);
        const [h, m] = fajr.split(":").map(Number);
        const fajrTomorrow = new Date(tomorrow.getFullYear(), tomorrow.getMonth(), tomorrow.getDate(), h, m);
        
        updateCountdown(fajrTomorrow, "Fajr (tomorrow)");
    }

    function updateCountdown(targetTime, prayerName) {
        function update() {
            const now = new Date();
            const diff = Math.floor((targetTime - now) / 1000);
            
            if (diff <= 0) {
                clearInterval(interval);
                updateTimetable(); // Refresh the timetable
                return;
            }

            const hours = Math.floor(diff / 3600);
            const minutes = Math.floor((diff % 3600) / 60);
            const seconds = diff % 60;
            const pad = n => n.toString().padStart(2, '0');
            
            document.getElementById("nextPrayer").textContent = 
                `Next prayer: ${prayerName} in ${pad(hours)}h ${pad(minutes)}m ${pad(seconds)}s`;
        }

        update(); // Initial call
        const interval = setInterval(update, 1000); // Update every second
    }

    function updateHijriDate() {
        try {
            const today = new Date();
            const hijriDate = new Intl.DateTimeFormat('en-TN-u-ca-islamic', {
                day: 'numeric',
                month: 'long',
                year: 'numeric'
            }).format(today);

            document.getElementById("hijriDate").textContent = `Hijri Date: ${hijriDate}`;
        } catch (error) {
            // Fallback: use a simple calculation or display a static message
            document.getElementById("hijriDate").textContent = "Hijri date not available";
        }
    }

    // Initialize
    updateTimetable();
    updateHijriDate();
    // Update the timetable every minute to catch prayer time changes
    setInterval(updateTimetable, 60000);
});